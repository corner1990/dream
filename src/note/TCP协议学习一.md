# TCP协议学习

### OSI网络模型分为7层

1. 物理层
2. 数据链路层
3. 网络层
4. 传输层
5. 会话层
6. 表示层
7. 应用层

### 软件开发者关注的网络模型

- 物理层对于软件开发者来说不用特别关注
- 表示层用于数据处理，压缩及安全问题，也不是一般软件开发者探讨的重点
- 我们关注的主要有：数据链路层，网络层，传输层以及应用层
- 我们常说的‘’四层‘’，七层就是分别对应着‘’传输层‘’和‘’应用层‘’在OSI中的排序位置，这四层也就是TCP/IP协议族的四个层次

### TCP/IP 

- 数据链路层：处理物理设备交互的具体细节
- 网络层：数据在网络中是分组传输，网络层处理分组在网络中的位置
- 传输层：也叫运输层，处理端到端的通信细节，这里指的是（端口到端口）
- 应用层：处理网络数据与应用程序的交互细节

```sequence
title:网络传输封包的过程
发送端->应用层: 每通过一层，增加首部
应用层->传输层: HTTP数据(TCP首部)
传输层->网络层:IP数据包(TCP首部，HTTP数据)
网络层->链路层:网络架构(以太网首部，ip首部，tcp首部，HTTP数据)
```

```sequence
title:网络传输解包的过程
链路层->网络层:网络架构(以太网首部，ip首部，tcp首部，HTTP数据)
网络层->传输层:IP数据包(TCP首部，HTTP数据)
传输层->应用层: HTTP数据(TCP首部)
应用层->接收送端: 最后拿到我们需要的数据


```

### 每次协议需要实现的功能

- 上层传递的数据包装成为满足该层协议的数据包
- 将下层传来的数据包解析为满足上层协议的数据包
- 处理与其他层的交互

### 数据链路层

- IDC路由骨干：路由器组成
- 核心交换机：由一组交换机组成
- 接入曾：由万兆交换机组成
- 业务区：由物理机组成
- 可以使用[wireshark](https://www.wireshark.org/download.html)抓包
- 需要注意的两点
  - 数据在同一网络中(局域网)传输，一般基于以太网技术，通过以太网传输的比特流称为‘‘帧’’
  - 操作系统内核必须直到目的端的硬件地址，才能传送‘‘帧’’
- 作用
  - 上层为网络层，接收IP数据报，发送IP数据至IP模块
  - 与ARP及RARP模块交互
  - 将32bit的IP地址转换为48bit的以太网地址
  - 发送ARP广播，活的目的端的IP地址和硬件地址
- ARP协议组成
  - 以太网首部
    - 以太网地址
    - 以太网源地址
    - 帧类型
  - ARP请求/应答
    - 硬件类型
    - 协议类型
    - 硬件地址长度
    - 协议地址长度
    - 操作
    - 发送端以太网地址
    - 发送端IP地址
    - 目的端以太网地址
    - 目的端IP地址
  - MUT: 最大传输单元

```flow
st=>start: 国内网(局域网)
idc=>operation: IDC路由骨干
add=>operation: 增值业务区
insert=>operation: 接入层
e=>end: 业务区

st->idc(right)->add->insert->e
```

